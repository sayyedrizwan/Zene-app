<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Zene Video</title>
        <style>
            * {
              padding: 0;
              margin: 0;
            }

            .player {
              position: fixed;
              left: 0;
              bottom: 0;
              width: 100%;
              height: 100%;
            }
        </style>
    </head>

    <body>
        <div id="player" class="player"></div>

        <script>
            async function setLocalStorageItem() {
              const currentTimestamp = Date.now();
              const threeMinutesBefore = currentTimestamp - 3 * 60 * 1000;
              const oneYearAfter = threeMinutesBefore + 365 * 24 * 60 * 60 * 1000;

              try {
                const value = JSON.stringify({
                  data: '{"quality":<<Quality>>,"previousQuality":<<Quality>>}',
                  expiration: oneYearAfter,
                  creation: threeMinutesBefore,
                });
                await new Promise((resolve) => setTimeout(resolve, 100));
                localStorage.setItem("yt-player-quality", value);
              } catch (error) {
                console.error("Error setting LocalStorage item:", error);
              }
            }

            document.addEventListener("DOMContentLoaded", (event) => {
              setLocalStorageItem();
            });

            var volumeCheckInterval;

            var tag = document.createElement("script");

            tag.src = "https://www.youtube.com/iframe_api";
            var firstScriptTag = document.getElementsByTagName("script")[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

            var player;
            function onYouTubeIframeAPIReady() {
              player = new YT.Player("player", {
                videoId: "<<VideoID>>",
                playerVars: {
                  autoplay: 1,
                  playsinline: 1,
                  mute: 0,
                  controls: 1,
                  showinfo: 0,
                  modestbranding: 1,
                  loop: 1,
                  fs: 0,
                  enablejsapi: 1,
                  rel: 0,
                },
                events: {
                  onReady: onPlayerReady,
                  onStateChange: onPlayerStateChange,
                  onError: onError,
                },
              });
            }

            function onError(event) {
              if (event.data == 150) {
                ZeneListener.regionSongError();
              }
            }

            function onPlayerReady(event) {
              event.target.playVideo();
              playerState(event.target, true);
            }

            function onPlayerStateChange(event) {
              playerState(event.target, true);

              clearInterval(volumeCheckInterval);
              if (event.data == YT.PlayerState.PLAYING) {
                volumeCheckInterval = setInterval(() => {
                  event.target.setVolume(40);
                }, 3000);
              }
            }

            function playerState(p, updatePlayback) {
              setTimeout(() => {
                ZeneListener.playerState(p.getPlayerState(), p.getDuration(), p.getCurrentTime(), updatePlayback);
              }, 500);
            }

            function pauseSong() {
              player.pauseVideo();
            }

            function playSong() {
              player.setVolume(40);
              player.playVideo();
            }

            function playerDurations() {
              if (player.getDuration() == undefined || player.getCurrentTime() == undefined) {
                ZeneListener.playerDuration(-1, -1);
              } else {
                ZeneListener.playerDuration(player.getCurrentTime(), player.getDuration());
              }
            }

            function seekTo(time) {
              player.seekTo(time, true);
              playerState(player, true);
            }

            function seekTo5sBack() {
              player.seekTo(player.getCurrentTime() - 5, true);
              playerState(player, true);
            }

            function seekTo5sForward() {
              player.seekTo(player.getCurrentTime() + 5, true);
              playerState(player, true);
            }

            function playbackSpeed(speed) {
              player.setPlaybackRate(speed);
              playerState(player, false);
            }
        </script>
    </body>
</html>
