<!DOCTYPE html>
<html lang="en">
    <head>
        <style>
            html, body {
                margin: 0;
                padding: 0;
                width: 100vw;
                height: 100vh;
                overflow: hidden;
            }

            .container {
                position: fixed;
                width: 100%;
                height: 100%;
                z-index: 100;
            }
        </style>
        <title>Zene Video Player</title>
    </head>
    <body>
        <div class="container">
            <div id="player"></div>
        </div>

        <script>
            async function setLocalStorageItem() {
              const currentTimestamp = Date.now();
              const threeMinutesBefore = currentTimestamp - 3 * 60 * 1000;
              const oneYearAfter = threeMinutesBefore + 365 * 24 * 60 * 60 * 1000;

              try {
                const value = JSON.stringify({
                  data: '{"quality":<<Quality>>,"previousQuality":<<Quality>>}',
                  expiration: oneYearAfter,
                  creation: threeMinutesBefore,
                });
                await new Promise((resolve) => setTimeout(resolve, 100));
                localStorage.setItem("yt-player-quality", value);
              } catch (error) {
                console.error("Error setting LocalStorage item:", error);
              }
            }

            document.addEventListener("DOMContentLoaded", (event) => {
              setLocalStorageItem();
            });


            var tag = document.createElement("script");

            tag.src = "https://www.youtube.com/iframe_api";
            var firstScriptTag = document.getElementsByTagName("script")[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

            var player;
            function onYouTubeIframeAPIReady() {
              player = new YT.Player("player", {
                height: "100%",
                width: "100%",
                videoId: "JQbjS0_ZfJ0",
                playerVars: { 'autoplay': 1, 'controls': 0, 'disablekb': 1, 'fs': 0, 'loop': 1, 'modestbranding': 1, 'rel': 0, 'showinfo': 0, 'mute': 1, 'autohide': 1 },
                events: {
                  onReady: onPlayerReady,
                  onStateChange: onPlayerStateChange,
                },
              });
            }

            function onPlayerReady(event) {
              event.target.unMute();
              event.target.setLoop(true);
              event.target.playVideo();
            }

            function playingStatus() {
              console.log({ status: player.getPlayerState(), currentTS: player.getCurrentTime(), duration: player.getDuration() });
            }

            function onPlayerStateChange(event) {
              playingStatus();
              if (event.data === YT.PlayerState.ENDED) player.loadVideoById("JQbjS0_ZfJ0");
            }

            function seekTo(v) {
              player.seekTo(v);
              playingStatus();
            }

            function stopVideo() {
              player.stopVideo();
            }

        </script>
    </body>
</html>
